#!/bin/bash

# Si le dossier n'existe pas on le crée
if [ ! -d ~/"sauvegarde" ]; then
    mkdir ~/sauvegarde
fi

# Remise des droits d'écriture sur le répertoire sauvegarde
chmod 700 ~/sauvegarde

# Determiner si c'est un fichier ou un dossier
for argument in $@
do
    # Récupération de l'extension du paramètre
    extension=".${argument##*.}"
    # Récupération du nom du fichier/dossier
    nomFichier="${argument%%.*}"
    #Traitement des dossiers
    if [[ $extension == ".$nomFichier" ]] ; then
        # Inutile mais pour s'assurer que les dossiers et fichiers sont bien reconnus
        echo "Dossier"
        # Si le dossier n'existe pas dans le dossier sauvegarde on le crée
        if [ ! -e ~/sauvegarde/$nomFichier ]; then
            mkdir ~/sauvegarde/$nomFichier
        else
            # Initialisation du compteur
            declare -i compt=0
            for (( ; ; )) ; do
                let "compt=compt+1"
                # Si le nom du dossier + compteur n'existe pas on le crée
                if [ ! -e ~/sauvegarde/$nomFichier$compt ]; then
                    mkdir ~/sauvegarde/$nomFichier$compt
                    break
                fi
                #Sinon le compteur prend +1 et réessaye
            done
        fi
    else    # Traitement des fichiers
        # Inutile mais pour s'assurer que les dossiers et fichiers sont bien reconnus
        echo "Fichier"
        #Si le fichier n'existe pas dans le dossier sauvegarde on le crée
        if [ ! -e ~/sauvegarde/$nomFichier$extension ]; then
            touch ~/sauvegarde/$nomFichier$extension
        else
            # Initialisation du compteur
            declare -i compt=0
            for (( ; ; )) ; do
                let "compt=compt+1"
                # Si le nom du fichier + compteur n'existe pas on le crée
                if [ ! -e ~/sauvegarde/$nomFichier$compt$extension ]; then
                    touch ~/sauvegarde/$nomFichier$compt$extension
                    break
                fi
                #Sinon le compteur prend +1 et réessaye
            done
        fi
    fi
done

# Suppression des droits d'écriture sur le dossier sauvegarde
chmod 500 ~/sauvegarde

